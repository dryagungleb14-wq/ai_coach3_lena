CHECKLIST = {
    "Установление контакта": {
        "1.1 Приветствие": {
            "description": "Назвать клиента по имени\nПредставиться самому\nУточнить, удобно ли говорить\nОзвучить цель звонка / проговорить структуру беседы",
            "max": {"score": 5, "criterion": "Менеджер выполнил все пункты в описании этапа"},
            "min": {"score": 0, "criterion": "Менеджер пропустил один из пунктов"}
        },
        "1.2 Наличие техники": {
            "description": "Есть ли компьютер/планшет для обучения",
            "max": {"score": 5, "criterion": "Менеджер запросил информацию о тех обеспечении"},
            "min": {"score": 0, "criterion": "Менеджер не запросил информацию о тех обеспечении"}
        }
    },
    "Диагностика": {
        "2.1 Выявление цели, боли": {
            "description": "Возраст ребенка, хобби, увлечения\nБыл ли опыт онлайн обучения ранее\nЦели обучения",
            "max": {"score": 10, "criterion": "Менеджер выполнил все пункты в описании этапа"},
            "mid": {"score": 5, "criterion": "Менеджер пропустил один из пунктов"},
            "min": {"score": 0, "criterion": "Менеджер не уточнил ни один из пунктов"}
        },
        "2.2 Критерии обучения": {
            "description": "Какие ожидания от обучения\nЧто важно при выборе программы",
            "max": {"score": 10, "criterion": "Менеджер уточнил ожидания от обучения и критерии выбора"},
            "min": {"score": 0, "criterion": "Менеджер не уточнил ожидания от обучения и критерии выбора"}
        }
    },
    "Продажа": {
        "3.1 Запись на пробное": {
            "description": "Имя ребенка, часовой пояс\nПопытка записи на пробное занятие",
            "max": {"score": 10, "criterion": "Менеджер уточнил все данные для создания семьи и сделал попытку записи на пробное"},
            "min": {"score": 0, "criterion": "Менеджер пропустил один из пунктов"}
        },
        "3.2 Повторная связь": {
            "description": "Если не готовы записываться, уточняем как скоро смогут присоединиться на пробное\nСтавим дату повторной коммуникации или договариваемся о записи в переписке",
            "max": {"score": 5, "criterion": "Менеджер уточнил дату повторной коммуникации или озвучил договоренности о записи в переписке"},
            "min": {"score": 0, "criterion": "Менеджер не договорился о повторной связи (в звонке или в переписке)"}
        }
    },
    "Презентация": {
        "4.1 Презентация формата": {
            "description": "Рассказываем про формат обучения (ИГФ в первую очередь), про платформу\nМинимум 1 боль и 1 цель должна быть привязана к презентации",
            "max": {"score": 10, "criterion": "Менеджер презентует обучение исходя из цели клиента (1-2 сейлзпоинта по привязке к потребности обязательно), рассказывает про формат и ценность\nОзвучиваются результаты обучения\nРассказывает о школе и то, как у нас можно реализовать цель клиента"},
            "mid": {"score": 5, "criterion": "Менеджер презентует обучение исходя из цели клиента не привязывая сейлзпоинты к потребности клиента"},
            "min": {"score": 0, "criterion": "Менеджер не провел презентацию формата"}
        },
        "4.2 Презентация до пробного": {
            "description": "Озвучивание информации для проведения пробного занятия",
            "max": {"score": 5, "criterion": "Менеджер озвучил информацию о необходимых условиях проведения пробного урока"},
            "min": {"score": 0, "criterion": "Менеджер не озвучил информацию о необходимых условиях"}
        }
    },
    "Работа с возражениями": {
        "5.1 Выявление возражений": {
            "description": "Сбор обратной связи после этапа презентации, есть ли возражения, сформированы ли ценности",
            "max": {"score": 10, "criterion": "Менеджер узнал, остались ли у клиента какие-то сомнения"},
            "min": {"score": 0, "criterion": "Менеджер пропустил этап или задал только закрытые вопросы"}
        },
        "5.2 Отработка возражений": {
            "description": "Отработка возражений клиента, не менее 2 попыток отработки на каждое возражение",
            "max": {"score": 10, "criterion": "Менеджер отработал все возражения\nЕсли возражений не было - баллы засчитываются на мах"},
            "mid": {"score": 5, "criterion": "Менеджер частично отработал возражения, сделал по 1 попытке отработки или не стал дожимать итоговое возражение"},
            "min": {"score": 0, "criterion": "Менеджер не отработал возражения"}
        }
    },
    "Завершение": {
        "6. Контрольные точки": {
            "description": "Структурировать все договоренности, которых достигли в течении диалога\nОзвучить дату повторной связи или договоренности о коммуникации в мессенджере\nНаправить корректную информацию в мессенджер после диалога",
            "max": {"score": 10, "criterion": "Менеджер озвучил договоренности и направил корректную информацию в мессенджер после диалога"},
            "mid": {"score": 5, "criterion": "Менеджер пропустил один из пунктов"},
            "min": {"score": 0, "criterion": "Менеджер не озвучил договоренности и не отправил информацию в мессенджер"}
        },
        "7. Корректность сделки": {
            "description": "Поставить в срм правильный сегмент студента в соответствии с гипотезой (номер гипотезы)\nПоставить корректную квалификацию студента после записи на пробное (если запись была)",
            "max": {"score": 5, "criterion": "Менеджер корректно проставил сегмент и квалификацию клиента в срм"},
            "min": {"score": 0, "criterion": "Менеджер некорректно проставил сегмент и квалификацию клиента в срм"}
        },
        "8. Грамотность": {
            "description": "Чистота речи (отсутствие слов паразитов, жаргонизмов, заиканий, посторонних звуков)\nГрамотная письменная и устная речь",
            "max": {"score": 5, "criterion": "Менеджер грамотен, речь чистая"},
            "min": {"score": 0, "criterion": "Менеджер допускает ошибки в звонке/переписке, есть посторонние звуки"}
        },
        "9. Нарушения": {
            "description": "Нарушил NDA\nГрубил клиенту\nОбсуждал запрещенные темы (религия/нация/политика и тд)\nСбросил звонок без видимых причины\nКритиковал компанию и/или конкурентов\n\nЛюбое нарушение этого блока ведет к полному обнулению скоринга звонка",
            "violation": True
        }
    }
}

def get_checklist_prompt():
    prompt = "Ты - эксперт по оценке качества звонков менеджеров по продажам. "
    prompt += "Твоя задача - объективно и последовательно оценить звонок по строгим критериям.\n\n"
    prompt += "ПРАВИЛА ОЦЕНКИ:\n"
    prompt += "1. Оценивай ТОЛЬКО по фактам из транскрипции. Не добавляй предположений.\n"
    prompt += "2. Для каждого критерия проверь, выполнено ли описание этапа.\n"
    prompt += "3. Сравни выполнение с критериями MAX/МИД/МИН и выбери соответствующий балл.\n"
    prompt += "4. Если транскрипция идентична - результат ДОЛЖЕН быть идентичен.\n"
    prompt += "5. Используй только допустимые баллы: 0, 5 или 10 (в зависимости от критерия).\n"
    prompt += "6. Будь строгим и объективным. Одинаковые действия = одинаковые баллы.\n\n"
    
    for stage_name, items in CHECKLIST.items():
        prompt += f"\n{stage_name}:\n"
        for item_key, item_data in items.items():
            if "violation" in item_data:
                prompt += f"\n{item_key}: {item_data['description']}\n"
                prompt += "ВАЖНО: Любое нарушение этого блока ведет к полному обнулению скоринга звонка (итоговая оценка = 0)\n"
            else:
                prompt += f"\n{item_key}:\n"
                prompt += f"Описание: {item_data['description']}\n"
                if "max" in item_data:
                    prompt += f"MAX ({item_data['max']['score']} баллов): {item_data['max']['criterion']}\n"
                if "mid" in item_data:
                    prompt += f"МИД ({item_data['mid']['score']} баллов): {item_data['mid']['criterion']}\n"
                if "min" in item_data:
                    prompt += f"МИН ({item_data['min']['score']} баллов): {item_data['min']['criterion']}\n"
    
    prompt += "\n\nВерни JSON в следующем формате:\n"
    prompt += "{\n"
    prompt += '  "1.1": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "1.2": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "2.1": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "2.2": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "3.1": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "3.2": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "4.1": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "4.2": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "5.1": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "5.2": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "6": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "7": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "8": {"score": число, "comment": "комментарий"},\n'
    prompt += '  "9": {"violation": true/false, "comment": "комментарий"}\n'
    prompt += "}\n"
    prompt += "\nЕсли в блоке 9 есть нарушение, установи violation: true и обнули все остальные баллы."
    prompt += "\n\nИспользуй только допустимые значения баллов: 0, 5 или 10 (в зависимости от критерия)."
    
    return prompt


